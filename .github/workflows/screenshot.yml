name: Take Screenshot

on:
  # 1. Runs automatically when you push code to the 'main' branch
  push:
    branches:
      - master

  # 2. Allows you to run it manually from the 'Actions' tab
  workflow_dispatch:

permissions:
  contents: write

jobs:
  screenshot:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node
        uses: actions/setup-node@v3

      - name: Install Puppeteer
        run: npm install puppeteer

      - name: Take Screenshot
        uses: actions/github-script@v6
        with:
          script: |
            const puppeteer = require('puppeteer');
            const browser = await puppeteer.launch();
            const page = await browser.newPage();
            
            // Set screen size (1280x800 is a good standard laptop size)
            await page.setViewport({ width: 1280, height: 800 });
            
            // Go to your website and wait until network is idle (no loading spinners)
            await page.goto('https://milankacar.github.io', { waitUntil: 'networkidle0' });
            
            // Ensure the 'images' folder exists (Node.js trick)
            const fs = require('fs');
            if (!fs.existsSync('images')){
                fs.mkdirSync('images');
            }

            // Save the screenshot
            await page.screenshot({ path: 'images/homepage-preview.png', fullPage: false });
            
            await browser.close();

      - name: Commit and Push Screenshot
        run: |
          git config --global user.name "MilanKacar"
          git config --global user.email "milankacar@live.com"
          
          # Check if there are changes to commit
          git add images/homepage-preview.png
          if git diff-index --quiet HEAD; then
            echo "No changes in screenshot to commit"
          else
            git commit -m "Auto-update homepage screenshot [skip ci]"
            git push
          fi
